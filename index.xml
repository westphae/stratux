<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>AHRS for Stratux</title>
    <link>https://westphae.github.io/stratux/index.xml</link>
    <description>Recent content on AHRS for Stratux</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>MIT license</copyright>
    <lastBuildDate>Sat, 21 Jan 2017 14:38:08 -0500</lastBuildDate>
    <atom:link href="https://westphae.github.io/stratux/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Collaboration</title>
      <link>https://westphae.github.io/stratux/collaboration/</link>
      <pubDate>Sat, 21 Jan 2017 14:38:08 -0500</pubDate>
      
      <guid>https://westphae.github.io/stratux/collaboration/</guid>
      <description>

&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/contact-bg.jpg&#34; alt=&#34;splash&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;issues&#34;&gt;Issues&lt;/h2&gt;

&lt;p&gt;Submit any issues on my fork&amp;rsquo;s &lt;a href=&#34;https://github.com/westphae/stratux/issues&#34;&gt;issues&lt;/a&gt; area.
Every flight creates a file in /var/log/sensors_YYYYMMDD_HHMMSS.csv, which you can upload.
It might also be helpful to upload /var/log/stratux.log in certain situations.&lt;/p&gt;

&lt;h2 id=&#34;feedback&#34;&gt;Feedback&lt;/h2&gt;

&lt;p&gt;Please contact me on &lt;a href=&#34;https://stratuxadsb.slack.com/team/bonanzaeric&#34;&gt;Slack&lt;/a&gt;, either with a direct message
or in the &lt;a href=&#34;https://stratuxadsb.slack.com/messages/ahrs/&#34;&gt;ahrs&lt;/a&gt; channel.&lt;/p&gt;

&lt;p&gt;If you&amp;rsquo;re not on Slack, you can use one of the links at left.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>A Stratux AHRS image for beta testers</title>
      <link>https://westphae.github.io/stratux/howto/</link>
      <pubDate>Thu, 19 Jan 2017 14:41:29 -0500</pubDate>
      
      <guid>https://westphae.github.io/stratux/howto/</guid>
      <description>

&lt;p&gt;I am excited to finally offer a Stratux image for anyone who would like to help beta test my initial AHRS solution!&lt;/p&gt;

&lt;h2 id=&#34;requirements&#34;&gt;Requirements&lt;/h2&gt;

&lt;p&gt;To use this image, in addition to the normal Stratux requriements, you&amp;rsquo;ll need to connect an MPU-9250 sensor to your Stratux.
The OpenFlightSolutions AHRS board is a great choice.
You can also use a RY836AI (tested), a SparkFun MPU-9250 breakout board (tested), or your own home brew.&lt;/p&gt;

&lt;p&gt;The code also has a driver for the BMP280, which also exists on both the OpenFlightSolutions AHRS board and the RY836AI.
If you have one of these boards or a separate dev board, the pressure altitude and rate of climb will be used in the algorithm.&lt;/p&gt;

&lt;div class=&#34;admonition note&#34;&gt;
&lt;p class=&#34;admonition-title&#34;&gt;Note&lt;/p&gt;
&lt;p&gt;I intended to support the MPU-9150 also (which is the sensor chip on the RY835AI).
However, the driver for this sensor was removed from the main Stratux code.
It was pretty ugly anyway&amp;ndash;it was a thin Go wrapper around the original C driver.
I may write a pure Go driver if there is sufficient interest.
The MPU-9250 performs better anyway.
The same is true of the BMP-180 (RY835AI) vs the BMP-280 (RY836AI).&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&#34;download&#34;&gt;Download&lt;/h2&gt;

&lt;p&gt;You can download the image from the &lt;a href=&#34;https://github.com/westphae/stratux/releases&#34;&gt;Releases&lt;/a&gt; area of the GitHub page.
Just burn it like any other Stratux image.&lt;/p&gt;

&lt;h2 id=&#34;sensor-pinout&#34;&gt;Sensor Pinout&lt;/h2&gt;

&lt;p&gt;Pinouts for the MPU-9250 are as follows:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;MPU-9250 Pin&lt;/th&gt;
&lt;th&gt;Raspberry Pi Pin&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;VDD&lt;/td&gt;
&lt;td&gt;Pin 02 (or 04)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;GND&lt;/td&gt;
&lt;td&gt;Pin 06&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;FSYNC&lt;/td&gt;
&lt;td&gt;Pin 09&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;SDA1&lt;/td&gt;
&lt;td&gt;Pin 03&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;SCL1&lt;/td&gt;
&lt;td&gt;Pin 05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The Raspberry Pi also has ground on pins 14, 20, 25, 30, and 39 that you can connect GND or FSYNC to.&lt;/p&gt;

&lt;p&gt;If you use the RY836AI, you can also connect its GPS:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;GPS Pin&lt;/th&gt;
&lt;th&gt;Raspberry Pi Pin&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;TXD&lt;/td&gt;
&lt;td&gt;Pin 10 (RXD0)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;RXD&lt;/td&gt;
&lt;td&gt;Pin 08 (TXD0)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/raspi_pins.png&#34; alt=&#34;Raspberry Pi Pins&#34; title=&#34;Raspberry Pi Pins&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Be sure to affix the sensor firmly to the Stratux box.
The sensor must not be able to move around in flight or the AHRS will give false indications.&lt;/p&gt;

&lt;h2 id=&#34;changes-to-stratux&#34;&gt;Changes to Stratux&lt;/h2&gt;

&lt;p&gt;Once you&amp;rsquo;ve connected the board and burned the image to your SDCard, you&amp;rsquo;re ready to go.&lt;/p&gt;

&lt;p&gt;There are just a few changes to cyoung/stratux.
First is a new Attitude Indicator in place of the old &amp;ldquo;paper airplane.&amp;rdquo;
Tilting the sensor should result in some motion of the AI, though possibly not in a way that makes sense &amp;ndash; because we haven&amp;rsquo;t calibrated it yet.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/AHRS_Screenshot.png&#34; alt=&#34;StratuxAI&#34; title=&#34;Stratux Horizon Indicator&#34; /&gt;&lt;/p&gt;

&lt;p&gt;There is also a &amp;ldquo;Calibrate AHRS Sensors&amp;rdquo; button on the &amp;ldquo;Settings&amp;rdquo; page.&lt;/p&gt;

&lt;p&gt;I also added a &amp;ldquo;CPU Load&amp;rdquo; area to the &amp;ldquo;Status&amp;rdquo; page.&lt;/p&gt;

&lt;h2 id=&#34;sensor-orientation&#34;&gt;Sensor Orientation&lt;/h2&gt;

&lt;p&gt;As noted earlier, it is crucial that the Stratux remain in one position in your aircraft&amp;ndash;if it slides around, it will lose orientation.
OpenFlightSolutions has a really nice base with a grippy bottom surface for their OpenFlightBox that works great for me.&lt;/p&gt;

&lt;p&gt;In this initial release, the Stratux will need to be oriented roughly at &amp;ldquo;right angles&amp;rdquo; to the pitch, yaw and roll axes of the airplane, so give some thought to how it will be situated in your aircraft.
It can sit in any orientation as long as one of the sensor&amp;rsquo;s X, Y, or Z axes (positive or negative) points forward, one toward the left wing, and one up.
I put mine on my glareshield with the antennae at the rear&amp;ndash;see the picture.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/stratux_glareshield.jpg&#34; alt=&#34;Stratux Placement&#34; title=&#34;Stratux placement on the glareshield&#34; /&gt;&lt;/p&gt;

&lt;p&gt;It will need to be oriented to within say 5° of the airplane&amp;rsquo;s axes to provide good data to the algorithm.
Eventually I may write a more sophisticated self-calibration routine that will orient itself automatically from any which angle, but for now we need to tell it precisely which direction is which.&lt;/p&gt;

&lt;h2 id=&#34;sensor-calibration&#34;&gt;Sensor Calibration&lt;/h2&gt;

&lt;p&gt;Now we will perform a &amp;ldquo;calibration.&amp;rdquo;
This is not a full sensor calibration, it is just a means to tell the AHRS algorithm the orientation of the Stratux box in the airplane, i.e. which sensor axis corresponds to which aircraft axis.
It needs to know which end of the sensor will point forward (along the roll axis), which end will point up (along the yaw axis), and which toward the left wing (along the pitch axis).
This only has to be done once, as long as you don&amp;rsquo;t change this gross orientation of the sensor to your airplane.
The setting will be stored with your other settings on your SDCard.
It goes without saying that this is best done on the ground, with the engine off&amp;hellip;&lt;/p&gt;

&lt;p&gt;The calibration routine uses gravity to tell the algorithm which way is which.
On the settings page, if you click on &amp;ldquo;Calibrate AHRS Sensors&amp;rdquo;, it will guide you through this process.
You will first orient the sensor so that the end that will be pointing forward in flight is instead pointing straight up.
&amp;ldquo;Straight&amp;rdquo; just means that it is pointing up more than the other two axes, say a pitch angle of 70° or more.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/stratux_orientation_1.jpg&#34; alt=&#34;Stratux Forward Orientation&#34; title=&#34;Stratux orientation for forward direction&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Then the axis which feels the most gravity will be considered &amp;ldquo;forward.&amp;rdquo;&lt;br /&gt;
Once you are holding the sensor in this attitude, &amp;ldquo;nose-up,&amp;rdquo; then click the &amp;ldquo;Set Forward Direction&amp;rdquo; button.&lt;/p&gt;

&lt;p&gt;Now you just place the sensor in the orientation it will ultimately rest in the airplane.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/stratux_orientation_2.jpg&#34; alt=&#34;Stratux Up Orientation&#34; title=&#34;Stratux orientation for up direction&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Then click the &amp;ldquo;Set Up Direction&amp;rdquo; button and gravity will tell the algorithm which direction will be Up.
From this, we know which direction will be toward the left wing.&lt;/p&gt;

&lt;p&gt;You&amp;rsquo;re now ready to fly!&lt;/p&gt;

&lt;h2 id=&#34;gps-only-attitude&#34;&gt;GPS-Only Attitude&lt;/h2&gt;

&lt;p&gt;There is already a &amp;ldquo;GPS-only&amp;rdquo; attitude system recently integrated into Stratux.
This was developed by @AvSquirrel.
It is considered a &amp;ldquo;pseudo-attitude&amp;rdquo; system because it does not use independent sensors to determine attitude&amp;ndash;it bases its attitude calculations only on GPS data.&lt;/p&gt;

&lt;p&gt;It is excellent code and works quite well.
However, because it doesn&amp;rsquo;t have sensors, it has several deficiencies.
Most notably, its attitude lags the aircraft&amp;rsquo;s actual attitude by a second or so; and it cannot correctly sense uncoordinated maneuvers.&lt;/p&gt;

&lt;p&gt;I retained this excellent code for users who do not have attitude sensors, which presumably will be the majority.
My fork will use the GPS-only attitude if there is no sensor present, or if the &amp;ldquo;Sensors&amp;rdquo; switch in the Hardware section of the Settings page is &amp;ldquo;off.&amp;rdquo;
Otherwise, it uses my AHRS calculations.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My Plan for AHRS Development</title>
      <link>https://westphae.github.io/stratux/plan/</link>
      <pubDate>Wed, 18 Jan 2017 16:40:25 -0500</pubDate>
      
      <guid>https://westphae.github.io/stratux/plan/</guid>
      <description>&lt;p&gt;I&amp;rsquo;ve been working on AHRS for about 9 months now.
My original approach was to use an Extended Kalman Filter.
This proved to be a bit more difficult than I&amp;rsquo;d expected!&lt;/p&gt;

&lt;p&gt;In order to get something working and build a framework to integrate it into the Stratux code, I instead took an approach I call the &amp;ldquo;SimpleAHRS&amp;rdquo; algorithm.
Like @AvSquirrel&amp;rsquo;s &amp;ldquo;GPS-only&amp;rdquo; approach, its foundation is an attitude estimate based on GPS.
Then the sensors are used to &amp;ldquo;tweak&amp;rdquo; the calculated attitude.
This allows it to respond to changes in attitude in realtime and to account somewhat for uncoordinated maneuvers.
However, it does still have a few deficiencies.
Mainly, it cannot get pitch quite right.
Also, uncoordinated maneuvers that persist for more than a few seconds will begin to display incorrectly.&lt;/p&gt;

&lt;p&gt;A true AHRS system should be based on a Kalman filter (or derivative) fusion of sensors:
* Gyros
* Accelerations
* Magnetometer
* GPS&lt;/p&gt;

&lt;p&gt;Even better is ADAHARS: Air Data And Heading Reference System.  This would also incorporate:
* Airspeed
* Barometer&lt;/p&gt;

&lt;p&gt;The current approach uses GPS, gyro and barometer.
The next iteration will use GPS, gyro, accelerometer, barometer, and possibly magnetometer.&lt;/p&gt;

&lt;p&gt;Mathematical details of the algorithms, simulations, etc. are or will be available in the documentation for &lt;a href=&#34;https://github.com/westphae/goflying&#34;&gt;https://github.com/westphae/goflying&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>AHRS for Stratux</title>
      <link>https://westphae.github.io/stratux/</link>
      <pubDate>Wed, 18 Jan 2017 22:36:35 +0000</pubDate>
      
      <guid>https://westphae.github.io/stratux/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;https://westphae.github.io/stratux/img/intro-bg.jpg&#34; alt=&#34;splash&#34; /&gt;&lt;/p&gt;

&lt;p&gt;This project is a &lt;a href=&#34;https://github.com/westphae/stratux&#34;&gt;fork&lt;/a&gt; of the &lt;a href=&#34;https://github.com/cyoung/stratux&#34;&gt;Stratux&lt;/a&gt; project.
It is mainly intended to provide AHRS (Attitude Heading and Reference System) features.&lt;/p&gt;

&lt;p&gt;I created this site to help beta testers to download, install, and use this fork,
and to provide me feedback and/or collaborate on its further development.&lt;/p&gt;

&lt;p&gt;AHRS support requires writing drivers for sensor hardware, Kalman filter and other approaches
for determining attitude from sensor input, and software simulators for testing these algorithms.
The main code for AHRS is in a separate GitHub repository of mine, &lt;a href=&#34;https://github.com/westphae/goflying&#34;&gt;https://github.com/westphae/goflying&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This fork incorporates minimal changes into the stratux code to integrate the AHRS code from the goflying library.
Hopefully it will eventually be merged into the main stratux project.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>